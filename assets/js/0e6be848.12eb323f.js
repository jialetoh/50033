"use strict";(self.webpackChunksite_docusaurus_template=self.webpackChunksite_docusaurus_template||[]).push([[7126],{109:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>p,default:()=>d,frontMatter:()=>s,metadata:()=>l,toc:()=>u});var i=n(7462),a=(n(7294),n(3905)),o=(n(1694),n(6596),n(6533)),r=(n(505),n(1496));n(4866),n(5162);const s={sidebar_position:1},p="ScriptableObject Game Architecture",l={unversionedId:"teen/scriptobjgamearch",id:"teen/scriptobjgamearch",title:"ScriptableObject Game Architecture",description:"This amazing talk inspires the existence of this section. We simply do not have enough time (unfortunately) to go into every single detailed implementation of common concepts such as game inventory, skill tree, etc but we hope that this quick introduction will point you into the right direction in the future.",source:"@site/docs/05-teen/scriptobjgamearch.md",sourceDirName:"05-teen",slug:"/teen/scriptobjgamearch",permalink:"/50033/docs/teen/scriptobjgamearch",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Unity for Teens",permalink:"/50033/docs/category/unity-for-teens"}},c={},u=[{value:"Preparation",id:"preparation",level:2},{value:"The Singleton Architecture",id:"the-singleton-architecture",level:2},{value:"Powerup Collection",id:"powerup-collection",level:3},{value:"Scriptable Object Game Architecture",id:"scriptable-object-game-architecture",level:2}],h={toc:u},m="wrapper";function d(e){let{components:t,...s}=e;return(0,a.kt)(m,(0,i.Z)({},h,s,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"scriptableobject-game-architecture"},"ScriptableObject Game Architecture"),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"This ",(0,a.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=raQ3iHhE_Kk"},"amazing talk")," inspires the existence of this section. We simply do not have enough time (unfortunately) to go into every single detailed implementation of common concepts such as game inventory, skill tree, etc but we hope that this quick introduction will point you into the right direction in the future.")),(0,a.kt)("p",null,"This topic covers an entirely new game architecture which separates data from code to make your game more maintanable and all around pleasant to work with. You can choose to go down the Singleton Path and utilising some SO for parts of your data that is supposed to be persistent. The choice is entirely up to you but we feel that it is our responsibility to introduce you to another great alternative using Scriptable Objects. This will revamp our existing project by quite a lot, but the benefits are worth it:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Scenes are clean slates"),(0,a.kt)("li",{parentName:"ul"},"No dependency between Systems and they are modular"),(0,a.kt)("li",{parentName:"ul"},"Prefabs work on their own"),(0,a.kt)("li",{parentName:"ul"},"Pluggable custom components")),(0,a.kt)("h2",{id:"preparation"},"Preparation"),(0,a.kt)("p",null,"We need at least two Scenes with completely clean slate. That\u2019s right. ",(0,a.kt)("span",{className:"orange-bold"},"Clean Slates"),". We can\u2019t reuse any of these Scripts anymore: GameManager, PowerupController, PlayerController, etc. To get you up to speed, you can:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Copy your main menu or loading scene if any, and World-1-1 and World-1-2 into a new folder"),(0,a.kt)("li",{parentName:"ol"},"Copy all prefabs used in these two worlds into a new folder, name it something else"),(0,a.kt)("li",{parentName:"ol"},"Replace the prefabs with the new prefabs (same, just another copy)"),(0,a.kt)("li",{parentName:"ol"},"Remove ",(0,a.kt)("strong",{parentName:"li"},"all scripts")," attached to any GameObject, do the same for the new set of prefabs")),(0,a.kt)("p",null,"Here's a complete recording on what we do to prepare for this lab. Lots of the setup is about step 3 above. If you want to simply copy the entire project and work on the copy directly, you may do so."),(0,a.kt)(r.Z,{path:"https://50033.s3.ap-southeast-1.amazonaws.com/week-5/setup.mp4",widthPercentage:"100%",mdxType:"VideoItem"}),(0,a.kt)("admonition",{type:"playtest"},(0,a.kt)("p",{parentName:"admonition"},"If your main menu and loading screen is simple, you may leave it as-is. Some error might pop up because the event called in some animation clip, e.g: mario-jump animation doesn't exist and it's fine. We can fix that later. Also, do not forget to update the ",(0,a.kt)("strong",{parentName:"p"},"build setting")," to include these new scenes instead. The setting can be found at File >> Build Settings.")),(0,a.kt)("h2",{id:"the-singleton-architecture"},"The Singleton Architecture"),(0,a.kt)("p",null,"If you've been following the lab faithfully so far, your current game architecture utilising Singletons is somewhat as follows:"),(0,a.kt)(o.Z,{path:n(5256).Z,customClass:"invert-color",widthPercentage:"100%",mdxType:"ImageCard"}),(0,a.kt)("p",null,"It's ",(0,a.kt)("em",{parentName:"p"},"decent"),", in a way that there's no cross-referencing between scripts attached to gameObject instances, ",(0,a.kt)("strong",{parentName:"p"},"except")," to Singletons: ",(0,a.kt)("inlineCode",{parentName:"p"},"GameManager")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"PowerupManager"),". Most chain of actions are triggered via events."),(0,a.kt)("h3",{id:"powerup-collection"},"Powerup Collection"),(0,a.kt)("p",null,"Every Powerup box (brick or question box) is controlled by a script inheriting ",(0,a.kt)("inlineCode",{parentName:"p"},"BasePowerupController"),"."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Whenever Mario hits a box (brick or question box), the ",(0,a.kt)("inlineCode",{parentName:"li"},"OnCollisionEnter2D")," will be called by Unity, which will trigger an ",(0,a.kt)("span",{className:"orange-bold"},"Animation")," (bouncing box, etc)."),(0,a.kt)("li",{parentName:"ul"},"From this animation, we call ",(0,a.kt)("inlineCode",{parentName:"li"},"SpawnPowerup()")," on the powerup inside the box. Any powerup (coin, starman, magic mushroom, and one-up mushroom) are spawned via ",(0,a.kt)("inlineCode",{parentName:"li"},"SpawnPowerup()")," method. ",(0,a.kt)("inlineCode",{parentName:"li"},"SpawnPowerup()")," ",(0,a.kt)("strong",{parentName:"li"},"invokes")," ",(0,a.kt)("inlineCode",{parentName:"li"},"powerupCollected")," event in PowerupManager Singleton, passing ",(0,a.kt)("strong",{parentName:"li"},"reference")," to itself in the process")),(0,a.kt)("p",null,"This calls the subscribers of ",(0,a.kt)("inlineCode",{parentName:"p"},"powerupCollected"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"FilterAndCastPowerup")," which decides whether to invoke ",(0,a.kt)("inlineCode",{parentName:"p"},"powerupAffectsManager")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"powerupAffectsPlayer")," based on the type of powerup invoking the event."),(0,a.kt)("p",null,"The subscribers of ",(0,a.kt)("inlineCode",{parentName:"p"},"powerupAffectsPlayer")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"powerupAffectsManager")," (Mario or Manager) will then be called. Any gameObject subscribing to these two ",(0,a.kt)("inlineCode",{parentName:"p"},"powerupAffectsX")," event should conform to ",(0,a.kt)("inlineCode",{parentName:"p"},"IPowerupApplicable")," interface containing ",(0,a.kt)("inlineCode",{parentName:"p"},"RequestPowerupEffect")," method, which is the method subscribing to ",(0,a.kt)("inlineCode",{parentName:"p"},"powerupAffectsX")," event."),(0,a.kt)("p",null,"In ",(0,a.kt)("inlineCode",{parentName:"p"},"RequestPowerupEffect"),", one simply passes itself (",(0,a.kt)("inlineCode",{parentName:"p"},"this"),") to the powerup triggering the chain of events from the start by calling ",(0,a.kt)("inlineCode",{parentName:"p"},"i.ApplyPowerup(this)"),". Then, the ",(0,a.kt)("strong",{parentName:"p"},"actual")," implementation (how this powerup is affecting ",(0,a.kt)("inlineCode",{parentName:"p"},"this"),") is implemented in that powerup script itself."),(0,a.kt)("p",null,"For instance, when Mario hits a question box containing MagicMushroom, it triggers ",(0,a.kt)("inlineCode",{parentName:"p"},"SpawnPowerup()")," which will animate the spawning of the MagicMushroom. When Mario collides with the MagicMushroom, ",(0,a.kt)("inlineCode",{parentName:"p"},"OnCollisionEnter2D")," on MagicMushroom's BasePowerup will be triggered, which will ",(0,a.kt)("strong",{parentName:"p"},"invoke")," ",(0,a.kt)("inlineCode",{parentName:"p"},"powerupCollected")," event, passing itself in the process. ",(0,a.kt)("inlineCode",{parentName:"p"},"FilterAndCastPowerup")," (subscriber of ",(0,a.kt)("inlineCode",{parentName:"p"},"powerupCollected"),") will examines the ",(0,a.kt)("inlineCode",{parentName:"p"},"PowerupType")," triggering this event, which is MagicMushroom and hence it invokes ",(0,a.kt)("inlineCode",{parentName:"p"},"powerupAffectsPlayer")," event instead, passing MagicMushroom instance in the process. This triggers the callback ",(0,a.kt)("inlineCode",{parentName:"p"},"RequestPowerupEffect")," in ",(0,a.kt)("inlineCode",{parentName:"p"},"PlayerMovement.cs")," attached on Mario. In ",(0,a.kt)("inlineCode",{parentName:"p"},"RequestPowerupEffect"),", we pass ",(0,a.kt)("inlineCode",{parentName:"p"},"this")," (which is Mario gameobject instance) to MagicMushroom via ",(0,a.kt)("inlineCode",{parentName:"p"},"ApplyPowerup")," method. Finally, in the MagicMushroomPowerup script we can decide ",(0,a.kt)("em",{parentName:"p"},"what the effect of this powerup is to Mario"),": which is to call ",(0,a.kt)("inlineCode",{parentName:"p"},"MakeSuperMario()")," method implemented in ",(0,a.kt)("inlineCode",{parentName:"p"},"PlayerMovement")," attached to Mario."),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"This is just one of the suggested method to prevent cross-referencing of scripts that needed to be done manually via inspector during runtime. The main idea is to modularise the implementation of the powerup effect as much as possible, implementing parts concerning that instances in the instance script and nowhere else. For instance: it is the MagicMushroom's responsibility to call Mario's: MakeSuperMario, and it is Mario's responsibility to decide what \"Super Mario\" should be.")),(0,a.kt)("h2",{id:"scriptable-object-game-architecture"},"Scriptable Object Game Architecture"))}d.isMDXComponent=!0},5256:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/singleton-archi-f12f694019dc0a4a149838e35e5438e4.png"}}]);